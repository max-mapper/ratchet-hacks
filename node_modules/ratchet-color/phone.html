<!DOCTYPE html>
<html>
<head>
  <title>color demo</title>
  <script type="text/javascript" src="bundle.js"></script>
  <script type="text/javascript" src="http://maker.github.com/ratchet/dist/ratchet.js"></script>
  <link rel="stylesheet" href="http://maker.github.com/ratchet/dist/ratchet.css">
  <link rel="stylesheet" href="http://maker.github.com/ratchet/css/docs.css">
  
  <style type="text/css">
    .instructions { text-align: center; width: 300px;}
    .picker { position: absolute; width: 300px; margin: 0px 10px; top: 75px; }
    .picker input { height: 200px; }
  </style>
</head>
<body>

<div class="iphone iphone-fixed" id="">
  <div class="iphone-content">
    <div id="iwindow">
      <header class="bar-title"> <a class="button" href="#">
    Left
  </a>

        <ul class="segmented-controller">
          <li class="active"> <a href="#">One</a>

          </li>
          <li> <a href="#">Two</a>

          </li>
          <li> <a href="#">Three</a>

          </li>
        </ul> <a class="button" href="#">
    Right
  </a>

      </header>
      <div class="picker">
        <input type="color" value="#a550e9"></input>
        <div class="instructions">PICK A COLOR</div>
      </div>
    </div>
  </div>
</div>
<script type="text/mustache" class="cssTemplate">
.bar-title {
  background-color: {{base}};
  background-image: -webkit-linear-gradient(top, {{base}} 0, {{buttonGradient}} 100%);
  background-image: linear-gradient(to bottom, {{base}} 0, {{buttonGradient}} 100%);
  border-bottom: 1px solid {{border}};
}

.bar-title [class*="button"] {
  background-color: {{base}};
  background-image: -webkit-linear-gradient(top, {{base}} 0, {{headerGradient}} 100%);
  background-image: linear-gradient(to bottom, {{base}} 0, {{headerGradient}} 100%);
  border: 1px solid {{border}};
}

.bar-title .segmented-controller {
  background-color: {{base}};
  background-image: -webkit-linear-gradient(top, {{base}} 0, {{headerGradient}} 100%);
  background-image: linear-gradient(to bottom, {{base}} 0, {{headerGradient}} 100%);
  border: 1px solid {{border}};
}

.bar-title .segmented-controller li {
  border-left: 1px solid {{border}};
}

.bar-title .segmented-controller li.active {
  background-color: {{active}};
}
</script>
<script type="text/javascript">
var calculator = require('ratchet-color')
var mustache = require('mustache')
var picker = document.querySelector('input')
picker.onchange = changeColor
changeColor()

function changeColor() {
  var color = picker.value
  var scheme = calculator(color)
  insertOverrideCSS(scheme)
  return false
}

function insertOverrideCSS(scheme) {
  var templateString = document.querySelector('.cssTemplate').text
  var data = {base: scheme[0], headerGradient: scheme[1], buttonGradient: scheme[2], border: scheme[3], active: scheme[4]}
  var rendered = mustache.to_html(templateString, data)
  console.log(data, rendered)
  addOverrideCSS(rendered)
}

function addOverrideCSS(css) {
  var existing = document.querySelector('.overrideStyles')
  if (existing) existing.parentNode.removeChild(existing)
  var head = document.getElementsByTagName('head')[0]
  var styleElement = document.createElement('style')
  styleElement.setAttribute('type', 'text/css')
  styleElement.appendChild(document.createTextNode(css))
  styleElement.className = "overrideStyles"
  head.appendChild(styleElement)
}
</script>
</body>
</html>